---
title: "UKHSA report"
format: html
bibliography: ../bibliography/UKHSA_bibliography.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{r, echo = FALSE}
#Loading the presentation stuff

source("../R_scripts/source_data_entry.R")
source("../R_scripts/source/swabs.R")
source("../R_scripts/source/primary_care_vis.R")
source("../R_scripts/source/hospitalisation_plots.R")

#For the vaccine plot
source("../R_scripts/source/vacc_plot.R")
```

## Introduction

Influenza is a highly infectious and rapidly evolving respiratory virus circulating seasonally around the world [@cope2018]. The World Health Organisation (WHO) estimates that between 290000-650000 deaths occur due to the respiratory virus, not including deaths not due to secondary infections caused by influenza [@WHO2022]. Antigenic shifts in the virus may result in uncontrolled extensive spread causing an epidemic (e.g. 1918-2009) [@cope2018]

Seasonal influenza appear in two types, classified as A and B. A types can are further broken down into subtypes H1N1 and H3N2 [@CDC2022]. Each year, a combination of the A subtypes and B type influenza circulate throughout the population with different proportions. There is some evidence to suggest that H3N2 subtype is more severe than H1N1, leading to higher hospitalisation rates.

Serious progression of the virus may lead to deaths in at risk groups such as children \<2 y.o., pregnant women, people \>65 y.o. and people with underlying medical conditions, [@zarocostas2009]. In a UK context, seasonal influenza circulation puts a burden on NHS especially hospital beds and GP services [@cope2018]. Having more data to help plan for seasonal peaks can help alleviate pressure on vital services.

![An infographic summarising the key points addressed in this report.](images/fig-intro.png)

### Who is UKHSA and why are they interested

UK Health Security Agency (UKHSA) was created as a successor to Public Health England in April 2021 cite. Set up during the height of the COVID-19 pandemic, the UKHSA's main priority is to tackle national health threats through the use of data analytics and developing vaccines cite.

Understanding the data of how flu is spread can help assist in planning vaccination roll-out. Vaccination is greatly beneficial as it averts between 180,000 and 626,000 cases of influenza per year in England, helping prevent between 5,678 and 8,800 premature deaths [@franklin2018]. Furthermore, every death averted due to vaccination is estimated to save the NHS Â£50,610 [@franklin2018].

In the UK there are three main ways that influenza is reported: through primary care data, hospitalisation and through swabbing programmes. Having three separate data sources is a valuable to compare whether the peak in the seasonal spread is in the same week or whether any of the data sources lag the others - identifying a possible prediction of a peak in hospitalisations for example. It also may be beneficial to know which strains are in circulation at which and what age group is being affected most. If there is a lag between age groups or strains, hosopitals may be able to prepare better for an oncoming wave of influenza cases.

### Research question and hypothesis

We defined our main research question to address the issues descirbed above.

*Question:* What is the temporal relationship between different influenza data sources (lab-confirmed infections, GP consultations, hospitalisations) in the UK, and have these changed in 2022/23 compared to the pre-pandemic years 2016-2019?

*Hypothesis:* We suspect that there is a time delay between one source of surveillance and another and the scale of the one that peaks earlier might be predictive of the later ones (GP consultations being greater than hospitalisations for example). Secondly we believe there could be changes in reporting procedures for resp infections post-covid (swabbing increases). As children have more interactions in schools and nurseries, we would expect a larger peak for children before a peak in the older population.

## Methods

### Data sources and extraction

![The data being used comes from various places and has been sourced through difference resources.](images/fig-data-source.png)

Primary care data was reported by the RCGP Research and Surveillance Centre communicable and respiratory disease reports, where cases of Influenza Like Illnesses that present in GP practices participating in the scheme are collected and reported for England and Wales [@RCGP]. 

Secondary care data is extracted from the UKHSA Severe Acute Respiratory Infection Watch system. 



### Time series correlation

We cases data 

-- jack correlation method of peaks


### Moving Epidemic Method

PHE and the UKHSA use the Moving Epidemic Method (MEM) to describe the severity of the epidemic season. This is calculated using through using previous epidemic activity [@Rachovic].
From for each of the data sources presented, we have used the MEM calculated and published by PHE and the UKHSA respectively in their weekly national flu reports.

### $R-0$ calculation

To further investgate the temporal relationships between the data sources, an effective reproduction number has been calculated. This can be inferred from the observed exponential growth rate seen at the beginning of a flu epidemic. The observed reproduction number $R$ can be found through the linear equation $R = 1 + \frac{r}{b}$ , where $r$ is the rate of exponential growth and $b$ is the rate of leaving the infectious stage [@lipsitch2003]. By approximating the beginning of the growth curves as $N=ke^{ \frac{rt}{b}}$ (where $k$ a constant),  the value $\frac {r}{b}$ can be found from the gradient when plotting $\log (N)$ against $t$. 

In practice, log graphs were plotted and a linear model was fitted to the points at the beginning of the epidemic. Using the gradient, the $R_{eff}$ was calculated for each data source, each season.   .



## Results

To see view the trends in the data and to first explore it, case rate per 100,000 people was ploted against epidemic week. Lines for each season have been represented on of the same plot, each for a different data source. 

### Source


::: grid

::: g-col-6
```{r echo= FALSE, warning = FALSE}
gp_cases

```
:::

::: g-col-6
```{r echo= FALSE, warning = FALSE,}
hospital_plot

```
:::

:::

**Figure x1 and x2**: FIgure x1 shows RCGP RSC reports of Influenze Like Illnesses in participating GP practices per 100,000 people across 4 flu seasons from 2017-2018 to 2022-23 with 2020-2021 and 2021-2022 removed. FIgure x2 shows flu cases reported by SARI watch and USISS Sentinel data for hospitalisations of patients with influenza per 100,000 people

::: grid

::: g-col-3

:::

::: g-col-6
```{r echo= FALSE, warning = FALSE}

combined_plot
```
:::

::: g-col-3

:::

:::

**Figure x**: Lab-confirmed cases of influenza, stratified by influenza strain (A and B). Data reported from PHE/UKHSA lab confirmed cases of influenza over the same time period.

In figures x1 and x2, we represent the Moving Epidemic Model thresholds against trends of primary and secondary care cases in the background. 

We expected to see that over different seasons, peaks appear at different weeks. This is due to the complex nature of flu spread, the dynamics do not replicate every season. The size of the peaks however do indicate differing levels of severity in flu each season. 

This initial presentation of our results shows similarity in temporal characterisitcs between the 2017-18 and 2018-19 flu seasons; and the 2019-20/2022-23 flu seasons. In primary care data, the peaks for the 2017-18 and 2018-19 flu seasons occur at 4 weeks (with a subsequent peak in 2018-19 at 7 weeks). We see a similar split in secondary care data. Secondary cases in 2017-18 peak at week 3, with a smaller peak across week 8-9. For 2018-19 it peaks at week 7. In lab confirmed cases of influenza A, both 2017-18 and 2018-19 flu seasons peak at week 7.

In the primary care data, the peaks for the 2019-20 and 22-23 season occur in the previous year at 52 and 50 weeks respectively. In secondary care data and lab confirmed cases of influenza A, the peaks for seasons 2019-20 and 2022-23 again occur in the previous year at week 52. 

Lab confirmed cases of influenza B 
  
- Mention how the data for the 2022-23 data is inconclusive

### Season

```{r echo= FALSE, warning = FALSE}
source("../R_scripts/Season_data/season_201718.R")
source("../R_scripts/Season_data/season_201819.R")
source("../R_scripts/Season_data/season_201920.R")
source("../R_scripts/Season_data/season_202223.R")

```

::: grid

::: g-col-6
```{r echo= FALSE, warning = FALSE}
plot_201718
```
:::

::: g-col-6
```{r echo= FALSE, warning = FALSE}
plot_201819
```
:::
:::

::: grid
::: g-col-6
```{r echo= FALSE, warning = FALSE}
plot_201920
```
:::

::: g-col-6
```{r echo= FALSE, warning = FALSE}
plot_202223
```
:::

:::

-- Jack matrix on correlation --

### Log graphs and $R_0$ value

```{r echo= FALSE, warning = FALSE}
source("../R_scripts/Season_data/log_graphs.R")

```



::: grid
::: g-col-6
```{r echo= FALSE, warning = FALSE}
log_hosp_plot1718

```
:::
::: g-col-6
```{r echo= FALSE, warning = FALSE}

log_hosp_plot1819

```
:::
:::

::: grid
::: g-col-6
```{r echo= FALSE, warning = FALSE}

log_hosp_plot1920

```
:::
::: g-col-6
```{r echo= FALSE, warning = FALSE}
log_hosp_plot2223
```
:::
:::

To estimate the effective reproduction number between each of the data sources, the case rate per 100,000 was transformed using a natural logarithm and plotted against epidemiological week. The log plot resulted in a straight line during the initial exponential growth period and a tail after the peak of infections, as was expected from theory. The plots were evaluated to find which weeks to fit a linear model to. Using the linear model function in R, a line was overlaid on the log plots and coefficients of gradients for each of the lines were extracted. Using $R = 1 + \frac{r}{b}$, as detailed above, the $R_{eff}$ was calculated.

The estimated $R_{eff}$ for each year and data source is detailed below. As expected at the beginning of a flu season, the R numbers are all above 1. It is noted that a higher reproduction number calculated for the data from hospitalisations than from GP consultations.

### Stratified by Flu strain type

::: grid
::: g-col-6
```{r echo = FALSE}

source("../R_scripts/Season_data/age_strat.R")
age1718
```

:::
::: g-col-6
```{r echo = FALSE}

age1822
```
:::

:::

Lab confirmed cases stratified by flu strain:

::: grid

::: g-col-6
``` {r echo=FALSE}
source("../strain_stratification.R")
strains17_18_swabs_plot
```
:::
::: g-col-6
``` {r echo=FALSE}
strains18_19_swabs_plot
```
:::
:::

::: grid
::: g-col-6
``` {r echo=FALSE}
strains19_20_swabs_plot
```
:::

::: g-col-6
``` {r echo=FALSE}
strains22_23_swabs_plot
```
:::

:::

``` {r echo=FALSE}
source("../R_scripts/log_graphs.R")
effective_r_values
```





## Discussion

## Conclusion

## References
